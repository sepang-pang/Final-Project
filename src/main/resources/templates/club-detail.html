<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title> λ™νΈν μƒμ„Έ μ΅°ν νμ΄μ§€ </title>

    <!--μ‚¬μ΄νΈ κΈ°λ³Έμ„¤μ •-->
    <meta name="description" content="λ™νΈν μƒμ„Έ νμ΄μ§€">
    <meta name="keywords" content="λ™νΈν">
    <meta name="author" content="μ¤μ„Έμ°½">

    <!--Viewport-->
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum=scale=1.0, minimum=scale=1.0">

    <!--(IE10)-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Normalize -->
    <link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <!--load CSS-->
    <link rel="stylesheet" href="/css/club-detail.css"> <!-- μ„λ²„ λλ¦΄ λ–„λ” ../static λΉΌμ•Όλ¨ -->

</head>
<body>
<div class="container">
    <div class="header-top">
        <button class="logout-btn">λ΅κ·Έμ•„μ›ƒ</button>
        <button class="profile-btn">λ‚΄ ν”„λ΅ν•„</button>
    </div>
    <header>
        <div class="title-group">
            <h1>κΈ€ μ λ©</h1>
            <span class="tag1" title="λ™νΈν λ€μ£Όμ ">λ™νΈν λ€μ£Όμ </span>
            <span class="tag2" title="λ™νΈν μ†μ£Όμ ">λ™νΈν μ†μ£Όμ </span>
            <span class="score" title="ν™λ™μ μ">π”¥</span> <span class="tag3">λ™νΈν ν™λ™μ μ</span>
        </div>
        <div class="button-group">
            <button class="btn btn-edit">μμ •</button>
            <button class="btn btn-delete">μ‚­μ </button>
            <button class="btn btn-siren" title="μ‹ κ³ ν•κΈ°" id="siren">μ‹ κ³ ν•κΈ°</button>
            <button class="btn-heart" title="μ°" id="heart">μ°</button>
        </div>
    </header>
</div>
<!-- section : λ³Έλ¬Έ λ‚΄μ© -->
<section>
    <header class="club-intro-header">
        <div class="photo-box">
            <img src="../static/images/sample.jpg" alt="λ™νΈν μ‚¬μ§„"/>
        </div>
    </header>
    <article class="club-intro-article">
        <p class="article-content">μ•λ…•ν•μ„Έμ”! μ—΄μ •μ΄ λ„μΉλ” μ¶•κµ¬ μ• νΈκ°€λ“¤μ λ¨μ„, [μ¶•κµ¬μ‹¶λƒ]μ…λ‹λ‹¤. β½οΈ
            ν•¨κ» λ•€μ„ νλ¦¬λ©°, μΆ‹μ€ μ¶”μ–µμ„ μ“μ•„κ°€λ” μ €ν¬ λ™νΈνλ” λ¨λ“  μ—°λ Ήλ€μ νμ›μ„ ν™μν•©λ‹λ‹¤. λ›°μ–΄λ‚ μ‹¤λ ¥λ³΄λ‹¤λ” μ„λ΅μ μ—΄μ •κ³Ό μ¶•κµ¬μ— λ€ν• μ‚¬λ‘μ„ κ°€μ¥ μ¤‘μ”ν•κ² μƒκ°ν•΄μ”.

            μ°λ¦¬ λ™νΈνμ νΉμ§•:

            μ£Ό 1ν μ •κΈ° λ¨μ„ λ° μ—°μµ
            μ—¬λ¬ λ™νΈνμ™€μ μΉμ„  κ²½κΈ°
            μ‹ μ… νμ› λ° μ΄λ³΄μ μ§€μ› ν”„λ΅κ·Έλ¨
            λ„κµ¬λ“ μ§€, μ–΄λ””μ„λ“ μ§€ μ¶•κµ¬μ μ¦κ±°μ›€μ„ λλ‚„ μ μλ” κ·Έλ° λ™νΈνλ¥Ό κΏκΏ‰λ‹λ‹¤. μ €ν¬μ™€ ν•¨κ» μ¶•κµ¬μ μ¦κ±°μ›€μ„ λ‚λ„κ³  μ‹¶λ‹¤λ©΄ μ–Έμ λ“  μ—°λ½μ£Όμ„Έμ”! ν•¨κ» ν–‰λ³µν• μκ°„μ„ λ§λ“¤μ–΄ κ°€μ”! β­οΈ

            κ°€μ΅± κ°™μ€ λ¶„μ„κΈ°μ—μ„ μ¶•κµ¬μ μ—΄μ •μ„ λ‚λ„κ³  μ‹¶λ‹¤λ©΄, μ§€κΈ λ°”λ΅ μ €ν¬ [μ¶•κµ¬μ‹¶λƒ]μ— κ°€μ…ν•μ„Έμ”! π‰</p>
    </article>
</section>

<hr class="section-divider">

<!-- section : μΌμ • -->
<section class="time-table">
    <header class="time-table-header">
        <h2>μΌμ •</h2>
        <!-- λ¨μ„ μƒμ„± λ²„νΌ -->
        <button id="createMeetingBtn">λ¨μ„ μƒμ„±</button>
    </header>
    <article class="time-table-article">
        <div class="no-schedule-message">
            <h3>μΌμ •μ΄ μ—†μµλ‹λ‹¤</h3>
        </div>
        <div class="cards-container">
            <!-- μΉ΄λ“κ°€ λ“¤μ–΄κ° μλ¦¬ -->
            <!-- JS 496 ~ 506 λ²μ§Έ μ¤„-->
        </div>
    </article>
</section>


<!-- section : club-info -->
<section class="club-info">
    <header class="club-info-header">
        <!-- λ²„νΌ κ·Έλ£Ή -->
        <div class="club-info-btn-group">
            <button class="club-btn">λ©¤λ²„</button>
            <button class="club-btn">μ„Έλ¶€μ •λ³΄</button>
            <button class="club-btn">λ¨μ„κΈ°λ΅</button>
            <button class="club-btn">ν™λ™μ§€μ—­</button>
            <button class="club-btn" onclick="showAlert()">μ±„ν…λ°©</button>
        </div>
    </header>

    <article class="club-info-article">
        <!-- λ™νΈνμ¥μ© article -->
        <div class="club-leader-view content-section" style="display: none;"> <!-- μ΄κΈ°μ— μ¨κΉ€ μ²λ¦¬. ν•„μ”μ— λ”°λΌ ν‘μ‹ν•κ² λ©λ‹λ‹¤. -->
            <div class="applicant-list">
                <!-- μ‹ μ²­μ λ©λ΅ -->
                <!-- JS 571 ~ 579 -->
            </div>
            <!-- λ©¤λ²„ λ©λ΅ -->
            <!-- JS 597 ~ 601 -->
            <div class="member-list">
            </div>
        </div>

        <!-- μΌλ° μ μ €μ© article -->
        <div class="regular-user-view content-section" style="display: none;"> <!-- μ΄κΈ°μ— μ¨κΉ€ μ²λ¦¬. ν•„μ”μ— λ”°λΌ ν‘μ‹ν•κ² λ©λ‹λ‹¤. -->
            <!-- λ©¤λ²„ λ©λ΅ -->
            <!-- JS 597 ~ 601 -->
            <div class="member-list">
            </div>
        </div>

        <!-- μ„Έλ¶€μ •λ³΄ section -->
        <div class="detail-info content-section" style="display: none;">
            <div class="club-details">
                <div class="detail">
                    <p>λ™νΈνμ¥: </p> <span class="leader-name"></span>
                </div>
                <div class="detail">
                    <p>μµλ€ μΈμ› μ: </p> <span class="max-members"></span>
                </div>
                <div class="detail">
                    <p>ν™λ™λ°©μ‹: </p> <span class="activity-method"></span>
                </div>
                <div class="detail">
                    <p>κ°€μ…μ μ°¨: </p> <span class="join-method"></span>
                </div>
            </div>
        </div>

        <!-- λ¨μ„κΈ°λ΅ section -->
        <div class="meeting-record content-section" style="display: none;">
            <div class="completed-meetings-list">
                <!-- μ—¬κΈ°μ— μ™„λ£λ λ¨μ„ λ‚΄μ©μ΄ μ¶”κ°€λ©λ‹λ‹¤. -->
                <!-- JS 540 ~ 544 -->
            </div>
        </div>

        <!-- ν™λ™μ§€μ—­ section -->
        <div class="activity-area content-section" style="display: none;">
            <div id="map" style="width:100%;height:350px;"></div>
        </div>
        <!--        &lt;!&ndash; μ±„ν…λ°© section &ndash;&gt;-->
        <!--        <div class="chat-room content-section" style="display: none;">-->
        <!--            <H1> μ±„ν…λ°© </H1>-->
        <!--        </div>-->
    </article>
    <nav class="apply">
        <button class="join-button">κ°€μ…ν•κΈ°</button>
    </nav>
</section>

<!-- Footer Section -->
<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>μ£Όκ΄€</h4>
            <p>μ¤νλ¥΄νƒ€ μ½”λ”©ν΄λ½</p>
        </div>
        <div class="footer-section">
            <h4>ν€</h4>
            <p>λ–΅μλ§μ„ λ°©λ²”λ€</p>
        </div>
        <div class="footer-section">
            <h4>λ©¤λ²„</h4>
            <p>μ¤μ„Έμ°½, κ³ μ€λΉ„, κΉ€λ™ν™, μ΄κ²½μ›</p>
        </div>
        <div class="footer-section">
            <h4>λ¬Έμ λ©”μΌ</h4>
            <p><a href="mailto:tpckd0533@naver.com">tpckd0533@naver.com</a></p>
        </div>
    </div>
</footer>

<!-- Create Meeting Modal -->
<div id="createMeetingModal" class="modal">
    <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
            <span class="close">&times;</span>
        </div>

        <!-- Modal Body - Page 1 -->
        <div class="modal-body-page1">
            <!-- Top section -->
            <section>
                <input type="text" id="title" placeholder="λ¨μ„μ μ΄λ¦„μ„ μ‘μ„±ν•΄μ£Όμ„Έμ” (ν•„μ)">
            </section>

            <!-- Mid section -->
            <section>
                <div>
                    <input type="text" id="imageLink" placeholder="ν™λ™ μ‚¬μ§„μ„ μ¬λ ¤λ³΄μ„Έμ” ! (μ„ νƒ)">
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
            </section>

            <!-- Bottom section -->
            <section>
                <textarea id="description" placeholder="λ¨μ„ λ‚΄μ©μ„ μ‘μ„±ν•΄μ£Όμ„Έμ” (ν•„μ)"></textarea>
            </section>
        </div>

        <!-- Modal Body - Page 2 -->
        <div class="modal-body-page2">
            <!-- Top section -->
            <section>
                <label for="maxMember">λ‡ λ…μ΄μ„ λ¨μΌκΉμ” ? (ν•„μ)</label>
                <input type="range" id="maxMember" min="5" max="30" step="1" value="5">
                <output for="maxMember">5λ…</output>
            </section>

            <!-- Middle section -->
            <section class="date-section">
                <!-- Header section -->
                <header class="date-section-header">
                    <label for="date">μ–Έμ  λ§λ‚ κΉμ” ? (ν•„μ)</label>
                </header>

                <!-- Article section -->
                <article class="date-section-article">
                    <div class="datetime-inputs">
                        <input type="date" id="date">
                        <select id="ampm">
                            <option value="μ¤μ „">μ¤μ „</option>
                            <option value="μ¤ν›„">μ¤ν›„</option>
                        </select>
                        <input type="number" id="hour" min="0" max="12" placeholder="hh">
                        <input type="number" id="minute" min="0" max="59" placeholder="mm">
                    </div>
                </article>
            </section>

            <!-- Bottom section -->
            <section>
                <label for="place">μ–΄λ””μ„ λ§λ‚ κΉμ” ? (ν•„μ)</label>
                <input type="text" id="place" placeholder="μ£Όμ† μ…λ ¥">
            </section>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
            <button id="prevButton">μ΄μ „</button>
            <button id="nextButton">λ‹¤μ</button>
            <button id="submitButton">μ™„λ£</button>
        </div>
    </div>
</div>

<!-- μ‹ κ³ μ°½ λ¨λ‹¬ -->
<div id="reportModal" class="report-modal">
    <div class="report-modal-content">
        <span class="close-report-modal">&times;</span>
        <h2>μ‹ κ³ ν•κΈ°</h2>
        <input type="text" id="reportTitle" placeholder="μ‹ κ³  μ λ©μ„ μ…λ ¥ν•μ„Έμ”" required>
        <textarea id="reportContent" rows="4" placeholder="μ‹ κ³  λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”" required></textarea>
        <button id="submitReport">μ‹ κ³  μ μ¶</button>
    </div>
</div>


<!----------------------------------------JS ---------------------------------------->
<script th:inline="javascript">
    window.onload = function () {
        const clubId = [[${clubId}]]; // clubμ μ•„μ΄λ””λ¥Ό PathVariableλ΅ λ°›μ•„μ΄.
        const currentUsername = [[${currentUsername}]];
        const clubUsername = [[${clubUsername}]];
        const likeStatus = [[${likeStatus}]]; // λ™νΈν μ° μƒνƒ
        const memberStatus = [[${memberStatus}]]; // λ™νΈν κ°€μ… μƒνƒ
        const applyStatus = [[${applyStatus}]]; // λ™νΈν κ°€μ… μ‹ μ²­ μƒνƒ
        const heartBtn = document.getElementById('heart');
        const sirenBtn = document.querySelector(".btn-siren");
        const editButton = document.querySelector('.btn-edit');
        const deleteButton = document.querySelector('.btn-delete');
        const joinButton = document.querySelector('.join-button'); // κ°€μ…ν•κΈ° λ²„νΌ μ„ νƒ
        const clubButtons = document.querySelectorAll('.club-btn');

        clubButtons.forEach(button => {
            button.addEventListener('click', () => {
                // λ¨λ“  λ²„νΌμ ν™μ„± μƒνƒ μ΄κΈ°ν™”
                clubButtons.forEach(btn => btn.classList.remove('active'));
                // ν„μ¬ ν΄λ¦­λ λ²„νΌλ§ ν™μ„± μƒνƒλ΅ μ„¤μ •
                button.classList.add('active');
            });
        });


        // ============== λ™νΈν κ΄€μ‹¬ λ©λ΅ λ‹΄κΈ° μ„¤μ • ============== //
        let isLiked = likeStatus; // likeStatus κ°’μ„ κΈ°λ°μΌλ΅ isLiked μ΄κΈ°ν™”

        // νμ΄μ§€ λ΅λ“μ‹ μ° μƒνƒμ— λ”°λΌ μ¤νƒ€μΌ μ μ©
        if (isLiked) {
            heartBtn.classList.add("clicked"); // ν΄λ¦­λ μ¤νƒ€μΌ μ¶”κ°€
        } else {
            heartBtn.classList.remove("clicked"); // ν΄λ¦­λ μ¤νƒ€μΌ μ κ±°
        }

        heartBtn.addEventListener('click', function () {
            if (isLiked) {
                heartBtn.classList.remove("clicked"); // ν΄λ¦­λ μ¤νƒ€μΌ μ κ±°
                deleteLikeClub(clubId); // κ΄€μ‹¬ λ™νΈν μ·¨μ† API νΈμ¶
            } else {
                heartBtn.classList.add("clicked"); // ν΄λ¦­λ μ¤νƒ€μΌ μ¶”κ°€
                addLikeClub(clubId); // λ™νΈν μ° λ‹΄κΈ° API νΈμ¶
            }
            isLiked = !isLiked; // μƒνƒ μ „ν™
        });

        // ============== λ‚΄ ν”„λ΅ν•„ κ°€κΈ° ============== //
        document.querySelector('.profile-btn').addEventListener('click', function () {
            window.location.href = "/api/my-profile";
        });

        // ============== λ΅κ·Έμ•„μ›ƒ κΈ°λ¥  ============== //
        document.querySelector('.logout-btn').addEventListener('click', function () {
            fetch('/logout', {
                method: 'POST',
            })
                .then(response => {
                    if (response.ok) {
                        alert('λ΅κ·Έμ•„μ›ƒ λμ—μµλ‹λ‹¤.');
                        window.location.href = "/login";
                    } else {
                        alert('λ΅κ·Έμ•„μ›ƒ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                    }
                })
                .catch(error => {
                    console.error('Error during logout:', error);
                    alert('λ΅κ·Έμ•„μ›ƒ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”.');
                });
        });

        // μμ • λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ
        editButton.addEventListener("click", () => {
            alert("μ„λΉ„μ¤ μ¤€λΉ„μ¤‘μ…λ‹λ‹¤.");
        });

        // μ‚­μ  λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ
        deleteButton.addEventListener("click", () => {
            const isConfirmed = confirm("μ‚­μ ν•μ‹κ² μµλ‹κΉ?");
            if (isConfirmed) {
                fetch(`/api/clubs/${clubId}`, {
                    method: 'DELETE',
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("API νΈμ¶ μ‹¤ν¨");
                        }
                        return response.json();
                    })
                    .then(data => {
                        alert("μ‚­μ κ°€ λμ—μµλ‹λ‹¤.");
                        window.location.href = "/sub-main"; // λ¦¬λ””λ ‰μ…
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("μ‚­μ  κ³Όμ •μ—μ„ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.");
                    });
            }
        });

        // ============== μ£Όμ† μ„ νƒ μ°½ ============== //
        document.getElementById('place').addEventListener('click', function () {
            new daum.Postcode({
                oncomplete: function (data) {
                    // κ²°κ³Όκ°’μ—μ„ μ£Όμ† μ •λ³΄ κ°€μ Έμ™€μ„ inputμ— ν‘μ‹
                    document.getElementById('place').value = data.roadAddress;
                }
            }).open();
        });
        // ======================================== //


        // λ²„νΌ ν΄λ¦­ μ‹ μ„Ήμ…μ„ λ³΄μ—¬μ£Όλ” ν•¨μ
        const buttonToSectionMapping = {
            "μ„Έλ¶€μ •λ³΄": "detail-info",
            "λ¨μ„κΈ°λ΅": "meeting-record",
            "ν™λ™μ§€μ—­": "activity-area",
            "μ±„ν…λ°©": "chat-room"
        };

        // λ¨λ“  μ„Ήμ…μ„ κ°€μ Έμµλ‹λ‹¤.
        let sections = document.querySelectorAll('.content-section');

        document.querySelector('.club-info-btn-group').addEventListener('click', function (e) {
            if (e.target.classList.contains('club-btn')) {
                // λ¨λ“  μ„Ήμ…μ„ μ¨κΉλ‹λ‹¤.
                sections.forEach(section => {
                    section.style.display = 'none';
                });

                // μ±„ν…λ°©μ„ λλ €μ„ λ• κ²½κ³ μ°½μ„ λ„μ›λ‹λ‹¤.
                if (e.target.textContent === "μ±„ν…λ°©") {
                    alert("μ±„ν…λ°©μ€ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.");
                }

                if (e.target.textContent === "λ©¤λ²„") {
                    if (currentUsername === clubUsername) {
                        document.querySelector('.club-leader-view').style.display = 'block';
                    } else {
                        document.querySelector('.regular-user-view').style.display = 'block';
                    }
                } else {
                    // ν΄λ¦­λ λ²„νΌμ— ν•΄λ‹Ήν•λ” μ„Ήμ…λ§ λ³΄μ—¬μ¤λ‹λ‹¤.
                    let sectionToShow = buttonToSectionMapping[e.target.textContent];
                    if (sectionToShow) {
                        document.querySelector(`.${sectionToShow}`).style.display = 'block';
                    }
                }
            }
        });

        // λ™νΈνμ¥μΈμ§€ μΌλ° μ μ €μΈμ§€μ— λ”°λΌ ν™”λ©΄μ„ λ‹¤λ¥΄κ² ν‘μ‹
        const clubLeaderView = document.querySelector('.club-leader-view');
        const regularUserView = document.querySelector('.regular-user-view');

        if (currentUsername === clubUsername) {
            clubLeaderView.style.display = 'block';
            regularUserView.style.display = 'none';
        } else {
            clubLeaderView.style.display = 'none';
            regularUserView.style.display = 'block';
            editButton.style.display = "none";
            deleteButton.style.display = "none";
        }

        // ================================================== //

        // API νΈμ¶
        fetch(`/api/clubs/${clubId}`) // νƒ€μ„λ¦¬ν”„λ΅ λ°›μ•„μ¨ Id κ°’μ„ μ£Όμ… ν›„ API νΈμ¶
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                // λ°›μ•„μ¨ DTO μ ν•„λ“κ°’μ„ ν™”λ©΄μ— μ¶λ ¥
                document.querySelector('h1').textContent = data.name; // λ™νΈν μ΄λ¦„
                document.querySelector('.tag1').textContent = data.major; // λ™νΈν λ€μ£Όμ 
                document.querySelector('.tag2').textContent = data.minor; // λ™νΈν μ†μ£Όμ 
                document.querySelector('.tag3').textContent = data.activityScore; // λ™νΈν ν™λ™μ μ
                document.querySelector('.photo-box img').src = data.media; // λ™νΈν μ‚¬μ§„
                document.querySelector('.article-content').textContent = data.description; // λ™νΈν μ†κ°κΈ€
                document.querySelector('.leader-name').textContent = data.nickName; // λ™νΈνμ¥ μ΄λ¦„
                document.querySelector('.max-members').textContent = data.maxMember; // μµλ€ μΈμ› μ
                document.querySelector('.activity-method').textContent = data.activityType; // ν™λ™ λ°©μ‹
                document.querySelector('.join-method').textContent = data.joinType; // κ°€μ… λ°©μ‹

                // κ°€μ… λ°©μ‹μ— λ”°λΌ λ²„νΌ ν…μ¤νΈ λ³€κ²½
                if (applyStatus === true) {
                    joinButton.textContent = "μΉμΈ μ‹¬μ‚¬μ¤‘";
                    joinButton.disabled = true; // λ²„νΌ λΉ„ν™μ„±ν™”
                } else if (data.joinType === "μ¦‰μ‹ κ°€μ…") {
                    joinButton.textContent = "κ°€μ…ν•κΈ°";
                } else if (data.joinType === "κ°€μ… μΉμΈ") {
                    joinButton.textContent = "κ°€μ… μ‹ μ²­";
                }

                // μ§€λ„λ¥Ό μƒμ„±ν•©λ‹λ‹¤
                const mapContainer = document.getElementById('map');
                const mapOption = {
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // μ°μ„  μ„μ‹λ΅ μ¤‘μ‹¬ μΆν‘λ¥Ό μ„¤μ •
                    level: 3
                };
                const map = new kakao.maps.Map(mapContainer, mapOption);

                // μ£Όμ†-μΆν‘ λ³€ν™ κ°μ²΄ μƒμ„±
                const geocoder = new kakao.maps.services.Geocoder();

                // μ£Όμ†λ΅ μΆν‘λ¥Ό κ²€μƒ‰
                geocoder.addressSearch(data.locate, function (result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        map.setCenter(new kakao.maps.LatLng(result[0].y, result[0].x)); // μ§€λ„μ μ¤‘μ‹¬ μΆν‘λ¥Ό κ²€μƒ‰ κ²°κ³Ό μΆν‘λ΅ μ„¤μ •
                    } else {
                        console.log('κ²€μƒ‰ κ²°κ³Όκ°€ μ—†μµλ‹λ‹¤.');
                    }
                });
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });

        // ============== νμ›, λΉ„νμ› λ²„νΌ μ„¤μ • ============== //
        if (!memberStatus) {
            joinButton.style.display = 'block'; // λΉ„νμ›μΌ κ²½μ° κ°€μ…ν•κΈ° λ²„νΌμ„ λ³΄μ—¬μ¤λ‹λ‹¤.
            createMeetingBtn.style.display = 'none'; // λΉ„νμ›μΌ κ²½μ° λ¨μ„ μƒμ„± λ²„νΌμ„ μ¨κΉλ‹λ‹¤.
        } else {
            joinButton.style.display = 'none'; // νμ›μΌ κ²½μ° κ°€μ…ν•κΈ° λ²„νΌμ„ μ¨κΉλ‹λ‹¤.
            createMeetingBtn.style.display = 'block'; // νμ›μΌ κ²½μ° λ¨μ„ μƒμ„± λ²„νΌμ„ λ³΄μ—¬μ¤λ‹λ‹¤.
        }


        // ============== νμ›, λΉ„νμ› λ²„νΌ μ„¤μ • ============== //
        if (!memberStatus) {
            joinButton.style.display = 'block'; // λΉ„νμ›μΌ κ²½μ° κ°€μ…ν•κΈ° λ²„νΌμ„ λ³΄μ—¬μ¤λ‹λ‹¤.
            createMeetingBtn.style.display = 'none'; // λΉ„νμ›μΌ κ²½μ° λ¨μ„ μƒμ„± λ²„νΌμ„ μ¨κΉλ‹λ‹¤.
        } else {
            joinButton.style.display = 'none'; // νμ›μΌ κ²½μ° κ°€μ…ν•κΈ° λ²„νΌμ„ μ¨κΉλ‹λ‹¤.
            createMeetingBtn.style.display = 'block'; // νμ›μΌ κ²½μ° λ¨μ„ μƒμ„± λ²„νΌμ„ λ³΄μ—¬μ¤λ‹λ‹¤.
        }

        // κ°€μ…ν•κΈ° λ²„νΌ ν΄λ¦­ μ΄λ²¤νΈ
        joinButton.addEventListener('click', function () {
            fetch(`/api/clubs/${clubId}/apply`, {
                method: 'PUT'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(result => {
                    // "κ°€μ… ν•κΈ°" λ²„νΌμ„ λλ €μ„ λ•
                    if (joinButton.textContent === "κ°€μ…ν•κΈ°") {
                        alert("κ°€μ…μ΄ λμ—μµλ‹λ‹¤.");
                        location.reload();
                    }
                    // "κ°€μ… μ‹ μ²­" λ²„νΌμ„ λλ €μ„ λ•
                    else if (joinButton.textContent === "κ°€μ… μ‹ μ²­") {
                        alert("κ°€μ… μ‹ μ²­μ΄ μ™„λ£λμ—μµλ‹λ‹¤.");
                        window.location.href = "/main";
                    }
                })
                .catch(error => {
                    console.error("Error during club join:", error);
                    alert('ν”„λ΅ν•„ μ‘μ„±μ„ μ™„λ£ν•΄μ£Όμ„Έμ” (κ±°μ£Όμ§€, κ΄€μ‹¬μ‚¬)');
                });
        });


        // /{clubId}/uncompleted API νΈμ¶
        fetch(`/api/meetings/${clubId}/uncompleted`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(meetings => {
                const cardsContainer = document.querySelector('.cards-container');
                const noScheduleMessage = document.querySelector('.no-schedule-message');

                if (meetings.length === 0) {
                    noScheduleMessage.style.display = 'flex'; // μ—¬κΈ°μ„ λ©”μ‹μ§€λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.
                } else {
                    noScheduleMessage.style.display = 'none'; // λ©”μ‹μ§€λ¥Ό μ¨κΉλ‹λ‹¤.
                    meetings.forEach(meeting => {
                        const meetingCardHTML = `
                    <div class="card" data-meeting-id="${meeting.meetingId}">
                        <div class="card-title-section">
                            <h3 class="card-date">${meeting.date}</h3>
                            <h4 class="card-title">${meeting.title}</h4>
                        </div>
                        <div class="card-info-section">
                            <p>μΌμ‹ <span class="card-time">${meeting.dateDetail}</span></p>
                            <p>μ„μΉ <span class="card-location">${meeting.place}</span></p>
                            <p>μ°Έμ—¬μΈμ› <span class="card-participants">${meeting.memberCount} / ${meeting.maxMember}</span></p>
                        </div>
                    </div>
                `;
                        cardsContainer.innerHTML += meetingCardHTML;
                    });

                    // μΉ΄λ“ ν΄λ¦­ μ΄λ²¤νΈ μ¶”κ°€
                    const cards = document.querySelectorAll('.card');
                    cards.forEach(card => {
                        card.addEventListener('click', function () {
                            // λ°μ΄ν„° μ†μ„±μ—μ„ λ¨μ„ ID κ°€μ Έμ¤κΈ°
                            const meetingId = card.getAttribute('data-meeting-id');
                            window.location.href = `/api/meetings/meeting-detail/${meetingId}`;  // μƒμ„Έ νμ΄μ§€λ΅ μ΄λ™
                        });

                        card.style.cursor = 'pointer';  // μ»¤μ„ λ¨μ–‘ λ³€κ²½
                    });
                }
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });
        fetch(`/api/meetings/${clubId}/completed`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(completedMeetings => {
                const completedMeetingsList = document.querySelector('.completed-meetings-list');

                completedMeetings.forEach(meeting => {
                    const meetingItemHTML = `
                        <div class="completed-meeting-item" data-meeting-id="${meeting.meetingId}">
                            <h4>${meeting.description}</h4>
                            <p>λ‚ μ§: ${meeting.date}</p>
                            <p>λ“κΈ€ μ: ${meeting.commentCount}</p>
                        </div>`;
                    completedMeetingsList.innerHTML += meetingItemHTML;
                });
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });

        document.body.addEventListener('click', function (event) {
            if (event.target.classList.contains('completed-meeting-item')) {
                if (memberStatus === false) {
                    alert("λ™νΈν νμ›λ§ ν™•μΈ ν•  μ μμµλ‹λ‹¤.");
                } else {
                    const meetingId = event.target.getAttribute('data-meeting-id');
                    window.location.href = `/api/meetings/meeting-detail/${meetingId}`;
                }
            }
        });


        fetch(`/api/clubs/${clubId}/applies`) // μ‹ μ²­μ λ©λ΅μ„ νΈμ¶
            .then(response => response.json())
            .then(applies => {
                const applicantList = document.querySelector('.applicant-list');
                applies.forEach(apply => {
                    const applicantHTML = `
                        <div class="applicant" data-user-id="${apply.id}">
                            <img src="${apply.media}" alt="ν”„λ΅ν•„ μ‚¬μ§„">
                            <div class="nickname">${apply.nickName}</div>
                            <div class="action-buttons">
                                <button class="accept-btn" data-apply-id="${apply.id}">μΉμΈ</button>
                                <button class="reject-btn" data-apply-id="${apply.id}">κ±°μ </button>
                            </div>
                        </div>
                    `;
                    applicantList.innerHTML += applicantHTML;
                });
            });

        // λ©¤λ²„ λ©λ΅ λ¶λ¬μ¤κΈ°
        fetch(`/api/clubs/${clubId}/members`)
            .then(response => response.json())
            .then(members => {
                const memberList = document.querySelectorAll('.member-list');
                members.forEach(member => {
                    // λ™νΈνμ¥ μ—¬λ¶€μ— λ”°λΌ ν…μ¤νΈλ¥Ό λ³€κ²½ν•©λ‹λ‹¤.
                    let nicknameText = member.nickName;
                    if (member.username === clubUsername) {
                        nicknameText += " π‘‘"; // λ™νΈνμ¥ μ•„μ΄μ½
                    }
                    const memberHTML = `
                    <div class="member" data-user-id="${member.id}">
                        <img src="${member.media}" alt="ν”„λ΅ν•„ μ‚¬μ§„">
                        <div class="nickname">${nicknameText}</div>
                    </div>
                    `;

                    memberList.forEach(list => list.innerHTML += memberHTML);
                });
            });

        document.body.addEventListener('click', function (event) {
            if (event.target.classList.contains('accept-btn')) {
                const applyId = event.target.getAttribute('data-apply-id');

                fetch(`/api/clubs/applies/${applyId}/approve`, {
                    method: 'PUT'
                }).then(response => {
                    if (response.ok) {
                        alert('κ°€μ… μΉμΈ μ™„λ£!');
                        event.target.parentElement.parentElement.remove();  // μ‹ μ²­μ ν•­λ© μ κ±°
                    } else {
                        alert('μ¤λ¥ λ°μƒ. λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.');
                    }
                });
            } else if (event.target.classList.contains('reject-btn')) {
                const applyId = event.target.getAttribute('data-apply-id');

                fetch(`/api/clubs/applies/${applyId}/refuse`, {
                    method: 'PUT'
                }).then(response => {
                    if (response.ok) {
                        alert('κ°€μ… κ±°μ  μ™„λ£!');
                        event.target.parentElement.parentElement.remove();  // μ‹ μ²­μ ν•­λ© μ κ±°
                    } else {
                        alert('μ¤λ¥ λ°μƒ. λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.');
                    }
                });
            } else if (event.target.classList.contains('applicant') || event.target.classList.contains('member')) {
                const userId = event.target.getAttribute('data-user-id');
                window.location.href = `/api/profile/${userId}`;
            }
        });


        // ===================== λ™νΈν μ° λ“±λ΅  ===================== //
        function addLikeClub(clubId) {
            // μ”μ²­ λ°μ΄ν„° μ„¤μ •
            const requestData = {
                clubId: clubId
            };

            // fetch API μ‚¬μ©ν•μ—¬ API νΈμ¶
            fetch('/api/profile/like-club', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // ========================================================== //

        // ===================== λ™νΈν μ° ν•΄μ   ===================== //
        function deleteLikeClub(clubId) {
            // fetch API μ‚¬μ©ν•μ—¬ 'κ΄€μ‹¬ λ™νΈν μ·¨μ†' API νΈμ¶
            fetch(`/api/profile/like-club/${clubId}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // ========================================================== //

        // ===================== λ¨μ„ μƒμ„± λ¨λ‹¬μ°½ ===================== //
        let modal = document.getElementById("createMeetingModal");
        let btn = document.getElementById("createMeetingBtn");
        let span = document.getElementsByClassName("close")[0];
        let nextButton = document.getElementById("nextButton");
        let prevButton = document.getElementById("prevButton");
        let submitButton = document.getElementById("submitButton");
        let slider = document.getElementById("maxMember");
        let output = document.querySelector("output[for='maxMember']");

        btn.onclick = function () {
            modal.style.display = "block";
            document.querySelector(".modal-body-page1").style.display = "block";
            document.querySelector(".modal-body-page2").style.display = "none";
            nextButton.style.display = "block";
            prevButton.style.display = "none";
            submitButton.style.display = "none";
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        nextButton.onclick = function () {
            document.querySelector(".modal-body-page1").style.display = "none";
            document.querySelector(".modal-body-page2").style.display = "block";
            nextButton.style.display = "none";
            prevButton.style.display = "block";
            submitButton.style.display = "block";
        }

        prevButton.onclick = function () {
            document.querySelector(".modal-body-page1").style.display = "block";
            document.querySelector(".modal-body-page2").style.display = "none";
            nextButton.style.display = "block";
            prevButton.style.display = "none";
            submitButton.style.display = "none";
        }

        // ===================== μ¬λΌμ΄λ” μΈμ› μ λ³€ν™” ===================== //
        slider.oninput = function () {
            output.textContent = this.value + "λ…";
        }
        // ============================================================= //

        // Update imageLink input when a file is selected
        document.getElementById("imageUpload").addEventListener("change", function (event) {
            if (this.files && this.files[0]) {
                const fileName = this.files[0].name;
                document.getElementById("imageLink").value = fileName;
            }
        });
        // Submit form and create meeting
        submitButton.onclick = function () {
            let title = document.getElementById("title").value;
            let description = document.getElementById("description").value;
            let maxMember = document.getElementById("maxMember").value;
            let date = document.getElementById("date").value;
            let ampm = document.getElementById("ampm").value;
            let hour = document.getElementById("hour").value;
            let minute = document.getElementById("minute").value;
            let place = document.getElementById("place").value;

            // κ°’ κ²€μ‚¬
            if (!title || !description || !maxMember || !date || !ampm || !hour || !minute || !place) {
                alert('ν•„μ κ°’μ„ μ±„μ›μ£Όμ„Έμ”.');
                return; // μΆ…λ£ν•κ³  μ΄ν›„μ μ½”λ“λ¥Ό μ‹¤ν–‰ν•μ§€ μ•μµλ‹λ‹¤.
            }

            // Format date and time
            if (ampm === "μ¤ν›„" && hour !== "12") {
                hour = parseInt(hour) + 12;
            }
            let formattedDate = `${date} ${hour}:${minute}`;

            const meetingRequestDto = {
                title: title,
                description: description,
                maxMember: maxMember,
                place: place,
                date: formattedDate
            };

            const formData = new FormData();
            formData.append('meetingRequestDto', new Blob([JSON.stringify(meetingRequestDto)], {type: 'application/json'}));

            let fileInput = document.getElementById("imageUpload");
            let file = fileInput.files[0];

            // If no file is selected, create an empty one
            if (!file) {
                file = new File([], "empty", {type: "image/png"});
            }
            formData.append('file', file);

            // ===================== λ¨μ„ μƒμ„± API νΈμ¶ ===================== //
            fetch(`/api/meetings/${clubId}`, {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        alert('λ¨μ„μ΄ μƒμ„±λμ—μµλ‹λ‹¤.');
                        window.location.reload();
                    } else {
                        alert('μ¤λ¥ λ°μƒ. λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.');
                    }
                });

        }

        const reportModal = document.getElementById('reportModal');
        const closeBtn = document.querySelector('.close-report-modal');
        const submitReportBtn = document.getElementById('submitReport');

        // λ¨λ‹¬μ„ λ„μ°λ” μ΄λ²¤νΈ
        sirenBtn.addEventListener('click', function () {
            reportModal.style.display = 'block';
        });

        // λ¨λ‹¬ λ‹«κΈ° μ΄λ²¤νΈ
        closeBtn.addEventListener('click', function () {
            reportModal.style.display = 'none';
        });

        // μ‹ κ³  μ μ¶ μ΄λ²¤νΈ
        submitReportBtn.addEventListener('click', function () {
            const title = document.getElementById('reportTitle').value;
            const content = document.getElementById('reportContent').value;

            const reportData = {
                targetId: clubId, // μ΄λ―Έ clubIdλ¥Ό κ°€μ Έμ™”κΈ° λ•λ¬Έμ— μ‚¬μ© κ°€λ¥
                title: title,
                content: content
            };

            fetch("/api/report/club", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(reportData)
            })
                .then(response => {
                    if (response.ok) { // response μƒνƒκ°€ okμΈμ§€ ν™•μΈ
                        return response.json(); // μ‘λ‹µμ„ json ν•νƒλ΅ λ°ν™
                    } else {
                        throw new Error('μ‹ κ³  μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.κ³ ');
                    }
                })
                .then(data => {
                    alert("μ‹ κ³ κ°€ μ™„λ£λμ—μµλ‹λ‹¤.");
                    reportModal.style.display = 'none'; // λ¨λ‹¬ λ‹«κΈ°
                })
                .catch(error => {
                    alert(error.message);
                });
        });

        let activeModalContent = null; // ν„μ¬ ν™μ„±ν™”λ λ¨λ‹¬μ content
        let isDragging = false;
        let offsetX, offsetY;

        // λ¨λ‹¬ λ“λκ·Έ μ‹μ‘
        function startDrag(event) {
            isDragging = true;

            // ν„μ¬ .modal-contentμ μ„μΉλ¥Ό κ°€μ Έμµλ‹λ‹¤.
            const currentLeft = parseFloat(getComputedStyle(activeModalContent).left) || 0;
            const currentTop = parseFloat(getComputedStyle(activeModalContent).top) || 0;

            // ν„μ¬ μ„μΉμ™€ λ§μ°μ¤ ν¬μΈν„°μ μ°¨μ΄λ¥Ό μ¤ν”„μ…‹μΌλ΅ μ„¤μ •ν•©λ‹λ‹¤.
            offsetX = event.clientX - currentLeft;
            offsetY = event.clientY - currentTop;
        }

        // λ¨λ‹¬ λ“λκ·Έ μ¤‘
        function doDrag(event) {
            if (isDragging) {
                activeModalContent.style.left = event.clientX - offsetX + 'px';
                activeModalContent.style.top = event.clientY - offsetY + 'px';
            }
        }

        // λ¨λ‹¬ λ“λκ·Έ μΆ…λ£
        function endDrag() {
            isDragging = false;
        }

        // κΈ°λ³Έ λ¨λ‹¬μ— λ€ν• μ΄λ²¤νΈ λ¦¬μ¤λ„ μ„¤μ •
        document.querySelectorAll('.modal').forEach(modal => {
            modal.querySelector('.modal-header').addEventListener('mousedown', function (event) {
                activeModalContent = modal.querySelector('.modal-content'); // .modal-contentλ΅ λ³€κ²½
                startDrag(event);
            });
        });

        // μ‹ κ³  λ¨λ‹¬μ— λ€ν• μ΄λ²¤νΈ λ¦¬μ¤λ„ μ„¤μ •
        document.querySelectorAll('.report-modal').forEach(reportModal => {
            reportModal.addEventListener('mousedown', function (event) {
                activeModalContent = reportModal.querySelector('.report-modal-content');
                startDrag(event);
            });
        });

        // μ „μ²΄ λ¬Έμ„μ— λ€ν• mousemove λ° mouseup μ΄λ²¤νΈ λ¦¬μ¤λ„ μ„¤μ •
        document.addEventListener('mousemove', doDrag);
        document.addEventListener('mouseup', endDrag);


    }
</script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=94d5cbf2c7b1151b1ca7e03a028094c2&libraries=services"></script>
</body>
</html>
