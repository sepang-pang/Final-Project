<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title> λ™νΈν μƒμ„Έ μ΅°ν νμ΄μ§€ </title>

    <!--μ‚¬μ΄νΈ κΈ°λ³Έμ„¤μ •-->
    <meta name="description" content="λ™νΈν μƒμ„Έ νμ΄μ§€">
    <meta name="keywords" content="λ™νΈν">
    <meta name="author" content="μ¤μ„Έμ°½">

    <!--Viewport-->
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum=scale=1.0, minimum=scale=1.0">

    <!--(IE10)-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Normalize -->
    <link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css'>

    <!--load CSS-->
    <link rel="stylesheet" href="//css/club-detail.css"> <!-- μ„λ²„ λλ¦΄ λ–„λ” ../static λΉΌμ•Όλ¨ -->
</head>
<body>
<div class="container">
    <header>
        <div class="title-group">
            <h1>κΈ€ μ λ©</h1>
            <span class="tag1">λ™νΈν λ€μ£Όμ </span>
            <span class="tag2">λ™νΈν μ†μ£Όμ </span>
        </div>
        <div class="button-group">
            <div class="btn btn-siren"></div>
            <div class="btn btn-heart"></div>
        </div>
    </header>
</div>

<!-- section : λ³Έλ¬Έ λ‚΄μ© -->
<section>
    <header class="club-intro-header">
        <div class="photo-box">
            <img src="../images/sample.jpg" alt="λ™νΈν μ‚¬μ§„"/>
        </div>
    </header>
    <article class="club-intro-article">
        <p class="article-content">μ•λ…•ν•μ„Έμ”! μ—΄μ •μ΄ λ„μΉλ” μ¶•κµ¬ μ• νΈκ°€λ“¤μ λ¨μ„, [μ¶•κµ¬μ‹¶λƒ]μ…λ‹λ‹¤. β½οΈ
            ν•¨κ» λ•€μ„ νλ¦¬λ©°, μΆ‹μ€ μ¶”μ–µμ„ μ“μ•„κ°€λ” μ €ν¬ λ™νΈνλ” λ¨λ“  μ—°λ Ήλ€μ νμ›μ„ ν™μν•©λ‹λ‹¤. λ›°μ–΄λ‚ μ‹¤λ ¥λ³΄λ‹¤λ” μ„λ΅μ μ—΄μ •κ³Ό μ¶•κµ¬μ— λ€ν• μ‚¬λ‘μ„ κ°€μ¥ μ¤‘μ”ν•κ² μƒκ°ν•΄μ”.

            μ°λ¦¬ λ™νΈνμ νΉμ§•:

            μ£Ό 1ν μ •κΈ° λ¨μ„ λ° μ—°μµ
            μ—¬λ¬ λ™νΈνμ™€μ μΉμ„  κ²½κΈ°
            μ‹ μ… νμ› λ° μ΄λ³΄μ μ§€μ› ν”„λ΅κ·Έλ¨
            λ„κµ¬λ“ μ§€, μ–΄λ””μ„λ“ μ§€ μ¶•κµ¬μ μ¦κ±°μ›€μ„ λλ‚„ μ μλ” κ·Έλ° λ™νΈνλ¥Ό κΏκΏ‰λ‹λ‹¤. μ €ν¬μ™€ ν•¨κ» μ¶•κµ¬μ μ¦κ±°μ›€μ„ λ‚λ„κ³  μ‹¶λ‹¤λ©΄ μ–Έμ λ“  μ—°λ½μ£Όμ„Έμ”! ν•¨κ» ν–‰λ³µν• μκ°„μ„ λ§λ“¤μ–΄ κ°€μ”! β­οΈ

            κ°€μ΅± κ°™μ€ λ¶„μ„κΈ°μ—μ„ μ¶•κµ¬μ μ—΄μ •μ„ λ‚λ„κ³  μ‹¶λ‹¤λ©΄, μ§€κΈ λ°”λ΅ μ €ν¬ [μ¶•κµ¬μ‹¶λƒ]μ— κ°€μ…ν•μ„Έμ”! π‰</p>
    </article>
</section>

<!-- section : μΌμ • -->
<section class="time-table">
    <header class="time-table-header">
        <h2>μΌμ •</h2>
        <!-- λ¨μ„ μƒμ„± λ²„νΌ -->
        <button id="addCardBtn">λ¨μ„ μƒμ„±</button>
    </header>
    <article class="time-table-article">
        <div class="cards-container">
            <!-- μΉ΄λ“κ°€ λ“¤μ–΄κ° μλ¦¬ -->
        </div>
    </article>

    <!-- μΉ΄λ“ μ¶”κ°€λ¥Ό μ„ν• κ°„λ‹¨ν• λ¨λ‹¬ νΌ -->
    <div id="addCardModal" style="display: none;">
        <label>λ‚ μ§: <input type="text" id="inputDate" placeholder="μ: 09 / 11 (μ›”)"></label>
        <label>μ λ©: <input type="text" id="inputTitle" placeholder="λ³Όλ”λΌμ΄μ§€ ν”λ¦½"></label>
        <label>μΌμ‹: <input type="text" id="inputTime" placeholder="μ¤ν›„ 3:00"></label>
        <label>μ„μΉ: <input type="text" id="inputLocation" placeholder="μ„μΈμ‹ μƒμ•”λ™"></label>
        <label>μ°Έμ—¬μΈμ›: <input type="text" id="inputParticipants" placeholder="5/10"></label>
        <button id="submitCard">μ¶”κ°€ν•κΈ°</button>
    </div>
</section>

<!-- section : club-info -->
<section class="club-info">
    <header class="club-info-header">
        <!-- λ²„νΌ κ·Έλ£Ή -->
        <div class="club-info-btn-group">
            <button class="club-btn">λ©¤λ²„</button>
            <button class="club-btn">μ„Έλ¶€μ •λ³΄</button>
            <button class="club-btn">λ¨μ„κΈ°λ΅</button>
            <button class="club-btn">ν™λ™μ§€μ—­</button>
            <button class="club-btn" onclick="showAlert()">μ±„ν…λ°©</button>
        </div>
    </header>

    <article class="club-info-article">
        <!-- λ™νΈνμ¥μ© article -->
        <div class="club-leader-view content-section" style="display: none;"> <!-- μ΄κΈ°μ— μ¨κΉ€ μ²λ¦¬. ν•„μ”μ— λ”°λΌ ν‘μ‹ν•κ² λ©λ‹λ‹¤. -->
            <!-- μ‹ μ²­μ λ©λ΅ -->
            <div class="applicant-list">
            </div>

            <!-- λ©¤λ²„ λ©λ΅ -->
            <div class="member-list">
            </div>
        </div>

        <!-- μΌλ° μ μ €μ© article -->
        <div class="regular-user-view content-section" style="display: none;"> <!-- μ΄κΈ°μ— μ¨κΉ€ μ²λ¦¬. ν•„μ”μ— λ”°λΌ ν‘μ‹ν•κ² λ©λ‹λ‹¤. -->
            <!-- λ©¤λ²„ λ©λ΅ -->
            <div class="member-list">
            </div>
        </div>

        <!-- μ„Έλ¶€μ •λ³΄ section -->
        <div class="detail-info content-section" style="display: none;">
            <div class="club-details">
                <div class="detail">
                    <p>λ™νΈνμ¥</p> <span class="leader-name"></span>
                </div>
                <div class="detail">
                    <p>μµλ€ μΈμ› μ</p> <span class="max-members"></span>
                </div>
                <div class="detail">
                    <p>ν™λ™λ°©μ‹</p> <span class="activity-method"></span>
                </div>
                <div class="detail">
                    <p>κ°€μ…μ μ°¨</p> <span class="join-method"></span>
                </div>
            </div>
        </div>

        <!-- λ¨μ„κΈ°λ΅ section -->
        <div class="meeting-record content-section" style="display: none;">
            <div class="completed-meetings-list">
                <!-- μ—¬κΈ°μ— μ™„λ£λ λ¨μ„ λ‚΄μ©μ΄ μ¶”κ°€λ©λ‹λ‹¤. -->
            </div>
        </div>

        <!-- ν™λ™μ§€μ—­ section -->
        <div class="activity-area content-section" style="display: none;">
            <H1> ν™λ™μ§€μ—­ </H1>
        </div>
        <!--        &lt;!&ndash; μ±„ν…λ°© section &ndash;&gt;-->
        <!--        <div class="chat-room content-section" style="display: none;">-->
        <!--            <H1> μ±„ν…λ°© </H1>-->
        <!--        </div>-->
    </article>
</section>

<!-- Footer Section -->
<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>μ£Όκ΄€</h4>
            <p>μ¤νλ¥΄νƒ€ μ½”λ”©ν΄λ½</p>
        </div>
        <div class="footer-section">
            <h4>ν€</h4>
            <p>λ–΅μλ§μ„ λ°©λ²”λ€</p>
        </div>
        <div class="footer-section">
            <h4>λ©¤λ²„</h4>
            <p>μ¤μ„Έμ°½, κ³ μ€λΉ„, κΉ€λ™ν™, μ΄κ²½μ›</p>
        </div>
        <div class="footer-section">
            <h4>λ¬Έμ λ©”μΌ</h4>
            <p><a href="mailto:tpckd0533@naver.com">tpckd0533@naver.com</a></p>
        </div>
    </div>
</footer>



<!----------------------------------------JS ---------------------------------------->
<script th:inline="javascript">
    window.onload = function () {
        const clubId = [[${clubId}]]; // clubμ μ•„μ΄λ””λ¥Ό PathVariableλ΅ λ°›μ•„μ΄.
        const currentUsername = [[${currentUsername}]];
        const clubUsername = [[${clubUsername}]];
        const heartBtn = document.querySelector(".btn-heart");
        const sirenBtn = document.querySelector(".btn-siren");

        // λ²„νΌ ν΄λ¦­ μ‹ μ„μΉλ¥Ό μ μ‹ λ³€κ²½ν•λ” ν•¨μ
        function animateButton(btn) {
            btn.style.transition = "transform 0.1s";
            btn.style.transform = "translate(1px, 1px)";
            setTimeout(() => {
                btn.style.transition = "background-color 0.1s, transform 0.1s";
                btn.style.transform = "translate(0, 0)";
            }, 100);  // ν΄λ¦­ ν›„ 0.1μ΄ μ§€λ‚λ©΄ μ›λ μ„μΉλ΅ λμ•„μ΄
        }

        heartBtn.addEventListener("click", function () {
            if (heartBtn.style.backgroundImage.includes('/images/heart-white.png')) {
                heartBtn.style.backgroundImage = "url('/images/heart-red.png')";
            } else {
                heartBtn.style.backgroundImage = "url('/images/heart-white.png')";
            }
            animateButton(heartBtn);  // μ• λ‹λ©”μ΄μ… μ μ©
        });

        sirenBtn.addEventListener("click", function () {
            animateButton(sirenBtn);  // μ• λ‹λ©”μ΄μ… μ μ©
        });

        // ================================================== //
        // λ²„νΌ ν΄λ¦­ μ‹ μ„Ήμ…μ„ λ³΄μ—¬μ£Όλ” ν•¨μ
        const buttonToSectionMapping = {
            "μ„Έλ¶€μ •λ³΄": "detail-info",
            "λ¨μ„κΈ°λ΅": "meeting-record",
            "ν™λ™μ§€μ—­": "activity-area",
            "μ±„ν…λ°©": "chat-room"
        };

        // λ¨λ“  μ„Ήμ…μ„ κ°€μ Έμµλ‹λ‹¤.
        let sections = document.querySelectorAll('.content-section');

        document.querySelector('.club-info-btn-group').addEventListener('click', function (e) {
            if (e.target.classList.contains('club-btn')) {
                // λ¨λ“  μ„Ήμ…μ„ μ¨κΉλ‹λ‹¤.
                sections.forEach(section => {
                    section.style.display = 'none';
                });

                // μ±„ν…λ°©μ„ λλ €μ„ λ• κ²½κ³ μ°½μ„ λ„μ›λ‹λ‹¤.
                if (e.target.textContent === "μ±„ν…λ°©") {
                    alert("μ±„ν…λ°©μ€ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.");
                }

                if (e.target.textContent === "λ©¤λ²„") {
                    if (currentUsername === clubUsername) {
                        document.querySelector('.club-leader-view').style.display = 'block';
                    } else {
                        document.querySelector('.regular-user-view').style.display = 'block';
                    }
                } else {
                    // ν΄λ¦­λ λ²„νΌμ— ν•΄λ‹Ήν•λ” μ„Ήμ…λ§ λ³΄μ—¬μ¤λ‹λ‹¤.
                    let sectionToShow = buttonToSectionMapping[e.target.textContent];
                    if (sectionToShow) {
                        document.querySelector(`.${sectionToShow}`).style.display = 'block';
                    }
                }
            }
        });

        // λ™νΈνμ¥μΈμ§€ μΌλ° μ μ €μΈμ§€μ— λ”°λΌ ν™”λ©΄μ„ λ‹¤λ¥΄κ² ν‘μ‹
        const clubLeaderView = document.querySelector('.club-leader-view');
        const regularUserView = document.querySelector('.regular-user-view');

        if (currentUsername === clubUsername) {
            clubLeaderView.style.display = 'block';
            regularUserView.style.display = 'none';
        } else {
            clubLeaderView.style.display = 'none';
            regularUserView.style.display = 'block';
        }

        // ================================================== //

        // API νΈμ¶
        fetch(`/api/clubs/${clubId}`) // νƒ€μ„λ¦¬ν”„λ΅ λ°›μ•„μ¨ Id κ°’μ„ μ£Όμ… ν›„ API νΈμ¶
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                // λ°›μ•„μ¨ DTO μ ν•„λ“κ°’μ„ ν™”λ©΄μ— μ¶λ ¥
                document.querySelector('h1').textContent = data.name; // λ™νΈν μ΄λ¦„
                document.querySelector('.tag1').textContent = data.major; // λ™νΈν λ€μ£Όμ 
                document.querySelector('.tag2').textContent = data.minor; // λ™νΈν μ†μ£Όμ 
                document.querySelector('.article-content').textContent = data.description; // λ™νΈν μ†κ°κΈ€
                document.querySelector('.leader-name').textContent = data.nickName; // λ™νΈνμ¥ μ΄λ¦„
                document.querySelector('.max-members').textContent = data.maxMember; // μµλ€ μΈμ› μ
                document.querySelector('.activity-method').textContent = data.activityType; // ν™λ™ λ°©μ‹
                document.querySelector('.join-method').textContent = data.joinType;
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });


        document.getElementById('addCardBtn').addEventListener('click', function () {
            // μΉ΄λ“ μ¶”κ°€ λ¨λ‹¬μ„ λ³΄μ—¬μ¤€λ‹¤.
            document.getElementById('addCardModal').style.display = 'block';
        });

        document.getElementById('submitCard').addEventListener('click', function () {
            // μ‚¬μ©μκ°€ μ…λ ¥ν• μ •λ³΄λ¥Ό κ°€μ Έμ¨λ‹¤.
            const date = document.getElementById('inputDate').value;
            const title = document.getElementById('inputTitle').value;
            const time = document.getElementById('inputTime').value;
            const location = document.getElementById('inputLocation').value;
            const participants = document.getElementById('inputParticipants').value;

            // μƒ μΉ΄λ“ HTMLμ„ μƒμ„±ν•λ‹¤.
            const newCardHTML = `
            <div class="card">
                <div class="card-title-section">
                    <h3 class="card-date">${date}</h3>
                    <h4 class="card-title">${title}</h4>
                </div>
                <div class="card-info-section">
                    <p>μΌμ‹ <span class="card-time">${time}</span></p>
                    <p>μ„μΉ <span class="card-location">${location}</span></p>
                    <p>μ°Έμ—¬μΈμ› <span class="card-participants">${participants}</span></p>
                </div>
            </div>
        `;

            // μƒμ„±ν• μΉ΄λ“ HTMLμ„ .cards-containerμ— μ¶”κ°€ν•λ‹¤.
            const cardsContainer = document.querySelector('.cards-container');
            cardsContainer.innerHTML += newCardHTML;

            // μΉ΄λ“ μ¶”κ°€ λ¨λ‹¬μ„ μ¨κΈ΄λ‹¤.
            document.getElementById('addCardModal').style.display = 'none';

            // μ…λ ¥ ν•„λ“ μ΄κΈ°ν™”
            document.getElementById('inputDate').value = '';
            document.getElementById('inputTitle').value = '';
            document.getElementById('inputTime').value = '';
            document.getElementById('inputLocation').value = '';
            document.getElementById('inputParticipants').value = '';
        });

        // /{clubId}/uncompleted API νΈμ¶
        fetch(`/api/meetings/${clubId}/uncompleted`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(meetings => {
                const cardsContainer = document.querySelector('.cards-container');
                meetings.forEach(meeting => {
                    const meetingCardHTML = `
                <div class="card">
                    <div class="card-title-section">
                        <h3 class="card-date">${meeting.date}</h3>
                        <h4 class="card-title">${meeting.description}</h4>
                    </div>
                    <div class="card-info-section">
                        <p>μΌμ‹ <span class="card-time">${meeting.dateDetail}</span></p>
                        <p>μ„μΉ <span class="card-location">${meeting.place}</span></p>
                        <p>μ°Έμ—¬μΈμ› <span class="card-participants">${meeting.maxMember}</span></p>
                    </div>
                </div>
            `;
                    cardsContainer.innerHTML += meetingCardHTML;
                });
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });

        fetch(`/api/meetings/${clubId}/completed`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(completedMeetings => {
                const completedMeetingsList = document.querySelector('.completed-meetings-list');

                completedMeetings.forEach(meeting => {
                    const meetingItemHTML = `
            <div class="completed-meeting-item">
                <h4>${meeting.description}</h4>
                <p>λ‚ μ§: ${meeting.date}</p>
                <p>λ“κΈ€ μ: ${meeting.commentCount}</p>
            </div>
            `;
                    completedMeetingsList.innerHTML += meetingItemHTML;
                });
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error.message);
            });


        fetch(`/api/clubs/${clubId}/applies`) // μ‹ μ²­μ λ©λ΅μ„ νΈμ¶
            .then(response => response.json())
            .then(applies => {
                const applicantList = document.querySelector('.applicant-list');
                applies.forEach(apply => {
                    const applicantHTML = `
                        <div class="applicant">
                            <div class="profile-pic"></div>
                            <div class="nickname">${apply.nickName}</div>
                            <div class="action-buttons">
                                <button class="accept-btn" data-apply-id="${apply.id}">μΉμΈ</button>
                                <button class="reject-btn" data-apply-id="${apply.id}">κ±°μ </button>
                            </div>
                        </div>
                    `;
                    applicantList.innerHTML += applicantHTML;
                });
            });

        // λ©¤λ²„ λ©λ΅ λ¶λ¬μ¤κΈ°
        fetch(`/api/clubs/${clubId}/members`)
            .then(response => response.json())
            .then(members => {
                const memberList = document.querySelectorAll('.member-list');  // λ™νΈνμ¥ & μΌλ° μ μ €μ©
                members.forEach(member => {
                    const memberHTML = `
                        <div class="member">
                            <div class="profile-pic"></div>
                            <div class="nickname">${member.nickName}</div>
                        </div>
                    `;
                    memberList.forEach(list => list.innerHTML += memberHTML);
                });
            });

        document.body.addEventListener('click', function (event) {
            if (event.target.classList.contains('accept-btn')) {
                const applyId = event.target.getAttribute('data-apply-id');

                fetch(`/api/clubs/applies/${applyId}/approve`, {
                    method: 'PUT'
                }).then(response => {
                    if (response.ok) {
                        alert('κ°€μ… μΉμΈ μ™„λ£!');
                        event.target.parentElement.parentElement.remove();  // μ‹ μ²­μ ν•­λ© μ κ±°
                    } else {
                        alert('μ¤λ¥ λ°μƒ. λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.');
                    }
                });
            } else if (event.target.classList.contains('reject-btn')) {
                const applyId = event.target.getAttribute('data-apply-id');

                fetch(`/api/clubs/applies/${applyId}/refuse`, {
                    method: 'PUT'
                }).then(response => {
                    if (response.ok) {
                        alert('κ°€μ… κ±°μ  μ™„λ£!');
                        event.target.parentElement.parentElement.remove();  // μ‹ μ²­μ ν•­λ© μ κ±°
                    } else {
                        alert('μ¤λ¥ λ°μƒ. λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.');
                    }
                });
            }
        });
    };
</script>
</body>
</html>
